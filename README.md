# Dota 2 GSI Интеграция

Система для получения информации о текущем матче Dota 2 в реальном времени через Game State Integration (GSI) и сохранения данных в JSON файлы.

## Возможности

- Получение данных о матче в реальном времени
- Информация об игроках (KDA, золото, опыт, предметы)
- Данные о героях (здоровье, мана, способности)
- Информация о зданиях и событиях матча
- Автоматическое сохранение данных в JSON файлы
- Организация файлов по датам

## Требования

- Python 3.8 или выше
- [uv](https://github.com/astral-sh/uv) - быстрый менеджер пакетов Python
- Dota 2 (установленная через Steam)
- Доступ к файловой системе Dota 2

## Установка

1. Установите `uv` (если еще не установлен):
```bash
# Windows (PowerShell)
powershell -ExecutionPolicy ByPass -c "irm https://astral.sh/uv/install.ps1 | iex"

# Linux/macOS
curl -LsSf https://astral.sh/uv/install.sh | sh
```

2. Клонируйте или скачайте проект

3. Установите зависимости с помощью `uv`:
```bash
uv sync
```

Или создайте виртуальное окружение и установите зависимости:
```bash
uv venv
uv pip install -r requirements.txt
```

## Настройка

### 1. Настройка Game State Integration в Dota 2

1. Найдите папку конфигурации Dota 2:
   - Windows: `C:\Program Files (x86)\Steam\steamapps\common\dota 2 beta\game\dota\cfg\`
   - Linux: `~/.steam/steam/steamapps/common/dota 2 beta/game/dota/cfg/`
   - macOS: `~/Library/Application Support/Steam/steamapps/common/dota 2 beta/game/dota/cfg/`

2. Скопируйте файл `gsi_config/gamestate_integration_dota2.cfg` в эту папку

3. Если файл `gamestate_integration_dota2.cfg` уже существует, откройте его и добавьте или замените содержимое настройками из нашего файла

### 2. Настройка файрвола (если необходимо)

Убедитесь, что порт 3000 не заблокирован файрволом. Сервер работает на `127.0.0.1:3000`, поэтому обычно проблем не возникает.

## Запуск

1. Запустите сервер с помощью `uv`:
```bash
uv run python src/server.py
```

Или активируйте виртуальное окружение и запустите:
```bash
# Windows
.venv\Scripts\activate
python src/server.py

# Linux/macOS
source .venv/bin/activate
python src/server.py
```

Также можно использовать uvicorn напрямую:
```bash
uv run uvicorn src.server:app --host 127.0.0.1 --port 3000
```

Или через скрипт запуска:
```bash
uv run python run_server.py
```

2. Запустите Dota 2 и начните матч (любой режим)

3. Данные начнут автоматически сохраняться в папку `output/`

## Структура выходных данных

JSON файлы сохраняются в папке `output/` с организацией по датам:
```
output/
└── 2026-01-03/
    ├── match_1234567890_20260103_120000.json
    └── match_0987654321_20260103_130000.json
```

Каждый файл содержит:
- `match_start` - время начала матча
- `match_id` - ID матча (если доступен)
- `initial_state` - начальное состояние
- `updates` - массив обновлений с временными метками
- `current_state` - текущее состояние игры
- `last_update` - время последнего обновления
- `match_end` - время окончания матча (если матч завершен)
- `final_state` - финальное состояние

### Структура данных состояния

Каждое состояние содержит:
- `metadata` - метаданные (версия GSI, timestamp)
- `map` - информация о карте (время игры, состояние, режим)
- `player` - информация об игроке (KDA, золото, опыт)
- `hero` - информация о герое (уровень, здоровье, мана, статусы)
- `abilities` - список способностей с уровнями и кулдаунами
- `items` - предметы в слотах и сташе
- `buildings` - состояние зданий (башни, форты)
- `events` - события матча (рошан, убийства курьеров, чат)
- `raw_data` - оригинальные сырые данные от GSI

## Проверка работы

1. Проверьте, что сервер запущен и отвечает:
   - Откройте браузер: `http://127.0.0.1:3000/`
   - Должен вернуться JSON с `{"status": "running"}`

2. Проверьте health endpoint:
   - `http://127.0.0.1:3000/health`

3. Запустите матч в Dota 2 и проверьте:
   - Логи сервера должны показывать получение данных
   - В папке `output/` должны появляться новые файлы

## Настройка конфигурации

Вы можете изменить настройки в файле `src/config.py`:
- `SERVER_PORT` - порт сервера (по умолчанию 3000)
- `SERVER_HOST` - хост сервера (по умолчанию 127.0.0.1)
- `LOG_LEVEL` - уровень логирования (DEBUG, INFO, WARNING, ERROR)
- `SAVE_INTERVAL_SECONDS` - интервал сохранения (не используется, сохраняется при каждом обновлении)

## Устранение неполадок

### Данные не поступают

1. Убедитесь, что сервер запущен и слушает порт 3000
2. Проверьте, что файл `gamestate_integration_dota2.cfg` находится в правильной папке
3. Перезапустите Dota 2 после добавления конфига
4. Проверьте логи сервера на наличие ошибок

### Файлы не создаются

1. Убедитесь, что папка `output/` существует и доступна для записи
2. Проверьте логи сервера на наличие ошибок
3. Убедитесь, что матч действительно начался (не в меню)

### Порт занят

Если порт 3000 занят, измените его в:
- `src/config.py` - измените `SERVER_PORT`
- `gsi_config/gamestate_integration_dota2.cfg` - измените URI

## Примечания

- Сервер должен быть запущен до начала матча для корректной работы
- Данные сохраняются только во время активного матча
- Каждый матч создает отдельный JSON файл
- Оригинальные сырые данные сохраняются в поле `raw_data` для полной совместимости

## Лицензия

Проект создан для личного использования и обучения.

